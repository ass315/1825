<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			.cartList {
				width: 1205px;
			}
			
			ul {
				list-style: none;
			}
			
			.cartHead {
				border: 1px solid black;
				height: 50px;
			}
			
			.cartHead li {
				width: 200px;
				height: 50px;
				float: left;
				font: 32px/50px "楷体";
				text-align: center;
			}
			
			.goodInfo {
				border: 1px solid black;
				border-top: none;
				height: 50px;
			}
			
			.goodInfo li {
				float: left;
				width: 200px;
				height: 50px;
				float: left;
				font: 24px/50px "";
				text-align: center;
			}
			
			.goodInfo li input {
				width: 30px;
				text-align: center;
			}
			
			.goodInfo li.num a {
				display: inline-block;
				width: 10px;
				height: 20px;
				font: 12px/20px "";
				background: #ddd;
				text-decoration: none;
			}
			
			.goodInfo li img {
				width: 40px;
				height: 40px;
				margin-top: 5px;
				text-align: center;
			}
			
			.blank {
				height: 50px;
				font: 32px/50px "";
				text-align: center;
				border: 1px solid black;
				border-top: none;
				display: none;
			}
		</style>
		<link rel="stylesheet" type="text/css" href="../dist/currency.min.css"/>
		<link rel="stylesheet" type="text/css" href="../dist/shopping.min.css"/>
		<script type="text/javascript" src="../src/js/requestAnimationFrame.js"></script>
		<!-- <script type="text/javascript" src="../src/js/article.js"></script> -->
		<script type="text/javascript" src="../src/js/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="../src/js/jquery.fly.js"></script>
		<script type="text/javascript" src="../src/js/jquery.cookie.js"></script>
	</head>
	<body>
		<!-- 公用页头 -->
		<div id="top">
			<div id="top-top">
				<div id="top-top-top">
					<p>
						<a href="login.html"><img src="./img/index/top-login.gif" /></a>
						<a href="register.html"><img src="./img/index/top-zc.gif" /></a>
						
					</p>
					<ul>
						<li>
							<p></p>
							<a href="#">在线客服</a>
							<span></span>
						</li>
						<li>
							<p></p>
							<a href="#">关注我们</a>
							<span></span>
						</li>
						<li>
							<p></p>
							<a href="#">优惠券激活</a>
							<span></span>
						</li>
					</ul>
				</div>
			</div>
			<div id="top-logo">
				<img src="../src/img/index/logo.gif" />
				<img src="img/shopping/order-01.png" />
			</div>
		</div>
		
		<!-- 中间部分 -->
		
		<div id="main">
			<div id="shoppingCart">
				<div id="SC-top">
					<h2>我的购物车</h2>
				</div>
				<dl class="cartList">
					<dt>
						<ul>
							<li>商品名称</li>
							<li>商品单价</li>
							<li>购买数量</li>
							<li>金额小计</li>
							<li>会员优惠</li>
							<li>积分</li>
							<li>库存</li>
							<li>操作</li>
						</ul>
					</dt>
					<dd>
						<ul>
							<li>商品名称</li>
							<li>商品单价</li>
							<li>购买数量</li>
							<li>金额小计</li>
							<li>会员优惠</li>
							<li>积分</li>
							<li>库存</li>
							<li>操作</li>
						</ul>
					</dd>
					<dd>
						<ul>
							<li><img src="" >name</li>
							<li>price</li>
							<li><a href="">-</a><input type="" name="" id="" value="num" /><a href="">+</a></li>
							<li>87</li>
							<li>会员优惠</li>
							<li>积分</li>
							<li>库存</li>
							<li>操作</li>
						</ul>
					</dd>
				</dl>
				<div id="SC-total">
					<div id="SC-total-right">
						<p>
							<span>商品重量:&nbsp;</span>
							<span>0.312</span>
							<span>KG&nbsp;&nbsp;</span>
							
							<span>件数:&nbsp;</span>
							&nbsp;
							<span></span>
							<span>件</span>
						</p>
						<p>
							<span>货物总额:</span>
							<span>￥21.70</span>
						</p>
					</div>
				</div>
				<div id="SC-button">
					<ul>
						<li><img src="img/shopping/order-02.png" ></li>
						<li><a href="#">确认结算</a></li>
					</ul>
				</div>
			</div>
			<div id="collection">
				
			</div>
			<div id="content">
				
			</div>
			<div id="right">
				
			</div>
		</div>
		
		
		
		
		<!-- 公用页尾 -->
		<div id="foolter">
			<div id="friendlink">
				<ul>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					<li>
						<dl>
							<dt><b>关于我们</b></dt>
							<dd>猫城食品介绍</dd>
							<dd>猫城食品微博</dd>
							<dd>商务合作</dd>
							<dd>商城系统</dd>
						</dl>
					</li>
					
				</ul>
			</div>
			<div id="service">
				<ul>
					<li>
						<p></p>
						<span><span>全国5+1</span>&nbsp;&nbsp;满80包邮</span>
					</li>
					<li>
						<p></p>
						<span><span>全国5+1</span>&nbsp;&nbsp;满80包邮</span>
					</li>
					<li>
						<p></p>
						<span><span>全国5+1</span>&nbsp;&nbsp;满80包邮</span>
					</li>
				</ul>
			</div>
			<div id="foot">
				<p>
					<a href="#">首&nbsp;&nbsp;&nbsp;&nbsp;页</a>
					<span>|</span>
					<a href="#">联系我们</a>
					<span>|</span>
					<a href="#">加入猫城食品</a>
					<span>|</span>
					<a href="#">手机猫城食品</a>
				</p>
				<h6>Copyright&nbsp;@&nbsp;2009-2019&nbsp;morefood.com&nbsp;,&nbsp;All&nbsp;Rights&nbsp;Reserved&nbsp;上海猫城电子商务股份有限公司&nbsp;版权所有&nbsp;沪ICP备09068257号-7</h6>
				<h5>食品流通许可证编号&nbsp;：&nbsp;JY131011300035157&nbsp;酒类许可证&nbsp;：&nbsp;1406030114003051&nbsp;营业执照</h5>
				<ul>
					<li><img src="../src/img/index/biaoshi1125.gif" ></li>
					<li><img src="../src/img/index/biaoshi1125.gif" ></li>
					<li><img src="../src/img/index/biaoshi1125.gif" ></li>
					<li><img src="../src/img/index/biaoshi1125.gif" ></li>
				</ul>
			</div>
		</div>
		
		<script type="text/javascript">
			$(function(){
				
				$(this).parent().parent().parent().parent().next().children().eq(0).children().eq(0).children().eq(4).val(2);
				//取出在cookie中存的购物车信息
				var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
				// console.log(cartStr);
				
				//物品列表合集
				var cartAll = $(".goodInfo").parent().children();
				
				if(!cartStr){
					$(".blank").css({
						display:"block"
					})
				}else{
					var cartObj = convertCartStrToObj(cartStr);
					//遍历所有的商品生成html添加到购物车列表中去
					for(var id in cartObj){
						//商品信息对等
						var good = cartObj[id];
						var str = '<dd><ul class="goodInfo" data-good-id="' + id + '">' + 
						'<li><img src="' + good.src + '"/>' + good.name + '</li>' + 
						'<li>' + good.price + '</li>' + 
						'<li class="num">' + 
						'<a href="javascript:;" class="minus">-</a>' + 
						'<input type="text" value="' + good.num + '"/>' +
						'<a href="javascript:;" class="plus">+</a>' +
						'</li>' +
						'<li class="total">' + good.num * good.price + '</li>' + 
						'<li></li><li></li><li>'+ "有货" + '</li>'
						'<li><a href="javascript:;" class="del">删除</a><a href="javascript:;" class="del">加入收藏夹</a></li>' + 
						'</ul></dd>';
						//将上面的结构添加到cartList中去
						$(str).appendTo(".cartList");
					}
					//给每个商品添加从购物车删除的事件
					$('.goodInfo a.del').click(function(){
						//再页面上将商品信息删除，顺百年获取一个该商品的#id
						var id = $(this).parents('.goodInfo').remove().attr("data-good-id");
						//从cookie中将该商品删除
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						delete cartObj[id];
						
						//将新商品信息放回cookie
						$.cookie('cart',convertObjToCartStr(cartObj),{
							expires : 7,
							path : "/"
						})
					})
					
					//给增加按钮添加事件
					$(".goodInfo a.plus").click(function(){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						cartObj[id].num += 1;
						//将页面上现实的数量加1
						$(this).siblings("input").val("" + cartObj[id].num);
						//更新页面上的小计
						$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
						//将信息放回cookie
						$.cookie('cart',convertObjToCartStr(cartObj),{
							expires : 7,
							path : "/"
						})
					})
					//给减按钮添加点击事件
					$(".goodInfo a.minus").click(function(){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						if(cartObj[id].num > 1){
							//商品数量减少不能少于1
							cartObj[id].num -= 1;
							//将页面上显示的数量减1
							$(this).siblings("input").val("" + cartObj[id].num);
							//更新页面上的小计
							$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
							//更新底部小计
							$(this).parent().parent().parent().parent().next().children().eq(0).children().eq(0).children().eq(4).text();
							//将信息放回cookie
							$.cookie('cart',convertObjToCartStr(cartObj),{
								expires : 7,
								path : "/"
							})
						}
					})
					
					
					//改数量的input 绑定一个 blur事件
					$(".goodInfo li.num input").blur(function(){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						//判断用户输入是否合法
						var pattern = /^\d+$/;
						if(!pattern.test($(this).val())){
							cartObj[id].num = 1;
							$(this).val("1");
						}else{
							//修改一下数量
							cartObj[id].num = parseInt($(this).val());
						}
						$(this).siblings("input").val("" + cartObj[id].num);
						//更新页面上的小计
						$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
						//将信息方回cookie
						$.cookie('cart',convertObjToCartStr(cartObj),{
							expires : 7,
							path : "/"
						})
					})
				}
			})
			
			function convertCartStrToObj(cartStr){
				//如果是空字符串，即没有购物车信息，那么购物车为空，直接返回一个空对象
				if(!cartStr){
					return {};
				}
				var goods = cartStr.split(":");
				var obj = {};
				for(var i = 0;i < goods.length;i++){
					var data = goods[i].split(",");
					//以商品的ID为键，商品的其他信息为值，这个值也设计为一个对象
					obj[data[0]] = {
						name : data[1],
						price : parseFloat(data[2]),
						num : parseInt(data[3]),
						src : data[4]
					}
				}
				return obj;
			}
			
			function convertObjToCartStr(obj){
				var cartStr = "";
				for(var id in obj){
					if(cartStr){
						cartStr += ":";
					}
					cartStr += id + "," + obj[id].name + "," + obj[id].price + "," + obj[id].num + "," + obj[id].src;
				}
				return cartStr;
			}
		</script>
	</body>
</html>
